# ============================================
# E-COMMERCE BACKEND - DEVELOPMENT PROFILE
# Spring Boot 4.0.0 + Java 25
# ============================================
# This file overrides application.properties for development environment
# Use environment variables for sensitive data even in dev

# ─────────────────────────────────────────────
# LAZY INITIALIZATION (Dev Only - Faster Startup)
# ─────────────────────────────────────────────
spring.main.lazy-initialization=true

# ─────────────────────────────────────────────
# DATABASE - DEVELOPMENT
# ─────────────────────────────────────────────
spring.datasource.driver-class-name=org.postgresql.Driver
# CRITICAL-006 FIX: Removed deprecated hibernate.dialect property (auto-detected from datasource)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/eshop_Dev}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:thamilu*884*}

# HikariCP - Dev Settings
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.auto-commit=false

# ─────────────────────────────────────────────
# JPA & HIBERNATE - DEVELOPMENT
# ─────────────────────────────────────────────
# DDL Auto Options:
# - update: Keep test data, update schema (recommended for dev)
# - create: Drop and recreate on startup (fixes schema issues)
# - create-drop: Reset database on restart (useful for testing)
# - validate: Only validate schema (safer)
#spring.jpa.hibernate.ddl-auto=${JPA_DDL_AUTO:create-drop}
spring.jpa.hibernate.ddl-auto=create
# spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# Performance Tuning
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true
spring.jpa.properties.hibernate.default_batch_fetch_size=10

# Second-Level Cache (disabled for Caffeine-only configuration)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# Statistics for Debugging (Dev Only)
spring.jpa.properties.hibernate.generate_statistics=true

# CRITICAL-006 FIX: Removed deprecated hibernate.dialect property
# Hibernate 7 auto-detects dialect from datasource - explicit config not needed
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true

# ─────────────────────────────────────────────
# FLYWAY (Disabled in Dev - Using Hibernate DDL Auto)
# ─────────────────────────────────────────────
spring.flyway.enabled=false

# ─────────────────────────────────────────────
# REDIS - LOCAL (Running in Docker on localhost)
# ─────────────────────────────────────────────
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.database=0
spring.data.redis.timeout=1000ms
spring.data.redis.connect-timeout=500ms

# Redis Connection Pool
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=1000ms
spring.data.redis.lettuce.shutdown-timeout=200ms

# Redis repositories disabled (we use JPA only)
spring.data.redis.repositories.enabled=false

# Cache Type
spring.cache.type=redis
app.redis.enabled=true
app.redis.resilient.mode=true
app.redis.cache.default-ttl=3600

# ─────────────────────────────────────────────
# SECURITY - JWT (Development)
# ─────────────────────────────────────────────
# NOTE: Use a strong secret even in dev. Set via environment variable for security.
jwt.secret=${JWT_SECRET:dev-placeholder-0123456789abcdef0123456789abcdef0123456789abcdef01234567}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}
jwt.issuer=eshop-app
jwt.algorithm=HS512

# OAuth2 Resource Server - Keycloak Integration
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/eshop}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_JWKS_URI:http://localhost:8080/realms/eshop/protocol/openid-connect/certs}

# Spring Boot `JwtProperties` (app.security.jwt) - required by binding/validation
# Use Keycloak local dev endpoints where available; keep values safe for local dev only.
app.security.jwt.audiences=eshop-client
app.security.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/eshop}
app.security.jwt.jwk-set-uri=${KEYCLOAK_JWKS_URI:http://localhost:8080/realms/eshop/protocol/openid-connect/certs}
app.security.jwt.allowed-algorithms=RS256
app.security.jwt.access-token-expiry=PT15M
app.security.jwt.clock-skew=PT30S
app.security.jwt.authorities-claim-name=roles
app.security.jwt.authority-prefix=ROLE_

# ─────────────────────────────────────────────
# KEYCLOAK - ENABLED IN DEV
# ─────────────────────────────────────────────
keycloak.enabled=true
security.keycloak.enabled=true

# Safe defaults for local development Keycloak (non-production)
# Configure a local Keycloak instance or leave these defaults to disable Keycloak calls
keycloak.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:http://localhost:8080}
keycloak.realm=${KEYCLOAK_REALM:eshop}
keycloak.client-id=${KEYCLOAK_CLIENT_ID:eshop-backend}
keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET:aWHhjsbAeg8LeeTvtkDerrCQGhEuJ5ph}
# Admin credentials used by admin service (dev only)
keycloak.admin.username=${KEYCLOAK_ADMIN_USER:admin}
keycloak.admin.password=${KEYCLOAK_ADMIN_PASSWORD:admin}
keycloak.admin.client-id=${KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}

# Claim mappings object must be present (fields have defaults, but object cannot be null)
app.security.jwt.claim-mappings.username-claim=preferred_username
app.security.jwt.claim-mappings.email-claim=email
app.security.jwt.claim-mappings.realm-roles-path=realm_access.roles

# ─────────────────────────────────────────────
# SEED DATA CONFIGURATION (Development Only)
# ─────────────────────────────────────────────
app.seed.enabled=true

# # Default Passwords (DEV ONLY - DO NOT USE IN PRODUCTION)
# app.seed.password.admin=${SEED_PASS_ADMIN:admin123}
# app.seed.password.retail1=${SEED_PASS_RETAIL1:retail123}
# app.seed.password.wholesale1=${SEED_PASS_WHOLESALE1:wholesale123}
# app.seed.password.shop1=${SEED_PASS_SHOP1:shop123}
# app.seed.password.farmer1=${SEED_PASS_FARMER1:farmer123}
# app.seed.password.customer1=${SEED_PASS_CUSTOMER1:customer123}
# app.seed.password.delivery1=${SEED_PASS_DELIVERY1:delivery123}

# ───────────────────────────────────────────
# SEED USERS
# # ───────────────────────────────────────────
# app.seed.users[0].username=admin
# app.seed.users[0].email=admin@ecommerce.com
# app.seed.users[0].firstName=Admin
# app.seed.users[0].lastName=User
# app.seed.users[0].role=ADMIN

# app.seed.users[1].username=retail1
# app.seed.users[1].email=retail1@ecommerce.com
# app.seed.users[1].firstName=John
# app.seed.users[1].lastName=Retail
# app.seed.users[1].role=SELLER
# app.seed.users[1].sellerType=RETAILER

# app.seed.users[2].username=wholesale1
# app.seed.users[2].email=wholesale1@ecommerce.com
# app.seed.users[2].firstName=David
# app.seed.users[2].lastName=Wholesale
# app.seed.users[2].role=SELLER
# app.seed.users[2].sellerType=WHOLESALER

# app.seed.users[3].username=shop1
# app.seed.users[3].email=shop1@ecommerce.com
# app.seed.users[3].firstName=Sarah
# app.seed.users[3].lastName=Shop
# app.seed.users[3].role=SELLER
# app.seed.users[3].sellerType=BUSINESS

# app.seed.users[4].username=farmer1
# app.seed.users[4].email=farmer1@ecommerce.com
# app.seed.users[4].firstName=Ravi
# app.seed.users[4].lastName=Kumar
# app.seed.users[4].role=SELLER
# app.seed.users[4].sellerType=FARMER

# app.seed.users[5].username=customer1
# app.seed.users[5].email=customer1@ecommerce.com
# app.seed.users[5].firstName=Jane
# app.seed.users[5].lastName=Customer
# app.seed.users[5].role=CUSTOMER

# app.seed.users[6].username=delivery1
# app.seed.users[6].email=delivery1@ecommerce.com
# app.seed.users[6].firstName=Mike
# app.seed.users[6].lastName=Delivery
# app.seed.users[6].role=DELIVERY_AGENT

# # ───────────────────────────────────────────
# # SEED CATEGORIES
# # ───────────────────────────────────────────
# app.seed.categories[0].name=Electronics
# app.seed.categories[0].description=Electronic devices and gadgets
# app.seed.categories[1].name=Clothing
# app.seed.categories[1].description=Fashion and apparel

# ───────────────────────────────────────────
# SEED BRANDS
# ───────────────────────────────────────────
# ───────────────────────────────────────────
# SEED DATA HAS BEEN MOVED TO CODE PROVIDERS
# See: com.eshop.app.seed.provider package
# ───────────────────────────────────────────
# app.seed.brands[0].name=Samsung
# app.seed.brands[1].name=Nike

# app.seed.tags[0].name=new
# app.seed.tags[1].name=sale
# app.seed.tags[2].name=popular

# app.seed.shops[0].shopName=Tech Retail Store
# app.seed.shops[0].sellerUsername=retail1
# app.seed.shops[0].description=Best electronics for consumers - retail prices only
# 
# app.seed.shops[1].shopName=Mega Wholesale Center
# app.seed.shops[1].sellerUsername=wholesale1
# app.seed.shops[1].description=Bulk products for businesses - wholesale prices only
# 
# app.seed.shops[2].shopName=FlexiMart
# app.seed.shops[2].sellerUsername=shop1
# app.seed.shops[2].description=One-stop shop - retail for small orders, wholesale for bulk
# 
# app.seed.shops[3].shopName=Green Valley Farm
# app.seed.shops[3].sellerUsername=farmer1
# app.seed.shops[3].description=Fresh organic vegetables and fruits directly from farm

# app.seed.products[0].name=Samsung Galaxy S24
# app.seed.products[0].sku=SAMSUNG-S24-001
# app.seed.products[0].price=999.99
# app.seed.products[0].discountPrice=899.99
# app.seed.products[0].categoryName=Electronics
# app.seed.products[0].brandName=Samsung
# app.seed.products[0].shopName=Tech Retail Store
# app.seed.products[0].tags[0]=new
# app.seed.products[0].tags[1]=popular
# 
# app.seed.products[1].name=Nike Air Max
# app.seed.products[1].sku=NIKE-AIRMAX-001
# app.seed.products[1].price=150.00
# app.seed.products[1].discountPrice=120.00
# app.seed.products[1].categoryName=Clothing
# app.seed.products[1].brandName=Nike
# app.seed.products[1].shopName=Tech Retail Store
# app.seed.products[1].tags[0]=sale

# ─────────────────────────────────────────────
# PAYMENT GATEWAYS (Development/Test Mode)
# ─────────────────────────────────────────────
payment.enabled=true

# Stripe (Test Mode)
payment.stripe.enabled=true
# Keys must be provided via environment variables; no defaults here to avoid accidental leaks.
stripe.secret-key=${STRIPE_SECRET_KEY}
stripe.publishable-key=${STRIPE_PUBLISHABLE_KEY}
stripe.currency=USD
# Stripe API version used by server-side integrations
stripe.api-version=2023-10-16

# Razorpay (Test Mode)
razorpay.key-id=${RAZORPAY_KEY_ID:rzp_test_your_placeholder_key}
razorpay.key-secret=${RAZORPAY_KEY_SECRET:rzp_test_your_placeholder_secret}
razorpay.currency=INR

# PayU (Test Mode)
payu.merchant-salt=${PAYU_MERCHANT_SALT:payu_test_merchant_salt}

# ─────────────────────────────────────────────
# CORS - PERMISSIVE FOR DEVELOPMENT
# ─────────────────────────────────────────────
app.cors.allowed-origins=http://localhost:3000,http://localhost:4200,http://localhost:5173
app.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true
app.cors.max-age=3600
app.cors.exposed-headers=Authorization,Content-Type,X-Request-Id

# ─────────────────────────────────────────────
# LOGGING - VERBOSE FOR DEBUGGING
# ─────────────────────────────────────────────
logging.level.root=INFO
logging.level.com.eshop.app=DEBUG
logging.level.org.springframework.security=DEBUG
logging.file.name=logs/eshop-dev.log
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.stat=DEBUG

# Console Output - Colored and Pretty
logging.pattern.console=%d{HH:mm:ss.SSS} %clr(%-5level) [%thread] %cyan(%logger{36}) - %msg%n
spring.output.ansi.enabled=always

# ─────────────────────────────────────────────
# ERROR HANDLING - SHOW DETAILS IN DEV
# ─────────────────────────────────────────────
spring.mvc.problemdetails.enabled=true

# Application Debug Mode
app.debug=true

# ─────────────────────────────────────────────
# SWAGGER/OPENAPI - ENABLED FOR DEV
# ─────────────────────────────────────────────
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
app.openapi.enabled=true
app.security.swagger.enabled=true

# SpringDoc OpenAPI OAuth2/Keycloak integration (DEV ONLY)
springdoc.swagger-ui.oauth.client-id=eshop-client
springdoc.swagger-ui.oauth.use-pkce-with-authorization-code-grant=true
springdoc.swagger-ui.oauth.scope-separator=space
springdoc.cache.disabled=true
# Show JSON schemas (models) by default in Swagger UI for easier testing
springdoc.swagger-ui.default-models-expand-depth=1
springdoc.swagger-ui.default-model-expand-depth=1

# ─────────────────────────────────────────────
# ACTUATOR - FULL EXPOSURE FOR DEV
# ─────────────────────────────────────────────
management.endpoints.web.exposure.include=health,info,metrics,prometheus,caches,env,beans,mappings,loggers
management.endpoint.health.show-details=always

# ─────────────────────────────────────────────
# RATE LIMITING - RELAXED FOR DEV
# ─────────────────────────────────────────────
app.ratelimit.enabled=false

# Resilience4j - Increased limits for dev
resilience4j.ratelimiter.instances.productCreate.limit-for-period=100
resilience4j.ratelimiter.instances.search.limit-for-period=100
resilience4j.ratelimiter.instances.dashboard.limit-for-period=500
resilience4j.ratelimiter.instances.analytics.limit-for-period=100

# ─────────────────────────────────────────────
# TRACING - FULL SAMPLING FOR DEBUGGING
# ─────────────────────────────────────────────
management.tracing.sampling.probability=1.0

# ─────────────────────────────────────────────
# API CONFIGURATION
# ─────────────────────────────────────────────
api.version=1.0.0
api.expose-tech-stack=true
app.json.pretty-print=true



# ─────────────────────────────────────────────
# FILE UPLOAD - RELAXED LIMITS FOR DEVt
# ─────────────────────────────────────────────
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=100MB

# ─────────────────────────────────────────────
# CACHE - SHORTER TTL FOR DEV (Easy Testing)
# ─────────────────────────────────────────────
app.cache.dashboard.ttl=60
app.cache.statistics.ttl=60
app.cache.analytics.ttl=120
app.cache.products.ttl=300
app.cache.categories.ttl=600

# ─────────────────────────────────────────────
# PERFORMANCE - RELAXED FOR DEV
# ─────────────────────────────────────────────

server.tomcat.threads.max=50
server.tomcat.threads.min-spare=10