# ============================================
# E-COMMERCE BACKEND - TEST PROFILE
# Spring Boot 4.0.0 + Java 21
# ============================================

# ─────────────────────────────────────────────
# TEST CONTEXT
# ─────────────────────────────────────────────
spring.main.banner-mode=off
spring.main.lazy-initialization=true
spring.main.allow-bean-definition-overriding=true

# ─────────────────────────────────────────────
# DATABASE - POSTGRESQL (TEST)
# ─────────────────────────────────────────────
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/eshop_test}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:thamilu*884*}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP - Test Settings
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000

# ─────────────────────────────────────────────
# JPA - TEST CONFIGURATION
# ─────────────────────────────────────────────
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.defer-datasource-initialization=true

# Performance
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.format_sql=true

# Disable second-level cache for test isolation
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# ─────────────────────────────────────────────
# FLYWAY - DISABLED FOR TESTS
# ─────────────────────────────────────────────
spring.flyway.enabled=false

# ─────────────────────────────────────────────
# SECURITY - TEST MODE
# ─────────────────────────────────────────────
jwt.secret=${JWT_TEST_SECRET:this-is-a-very-long-test-secret-key-for-testing-purposes-only-needs-to-be-at-least-512-bits-long-for-hs512-algorithm}
jwt.expiration=3600000
jwt.refresh-expiration=86400000
jwt.issuer=eshop-test
jwt.algorithm=HS512

# OAuth2/Keycloak - Disabled
keycloak.enabled=false
security.keycloak.enabled=false
spring.security.oauth2.resourceserver.jwt.issuer-uri=
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration

# JWT Security Properties for Tests (mock values - tests won't connect to real Keycloak)
app.security.jwt.issuerUri=http://localhost:8080/realms/eshop-test
app.security.jwt.jwkSetUri=http://localhost:8080/realms/eshop-test/protocol/openid-connect/certs
app.security.jwt.audiences=eshop-test,account
app.security.jwt.authorityPrefix=ROLE_
app.security.jwt.authoritiesClaimName=roles
app.security.jwt.allowedAlgorithms=RS256,RS512
app.security.jwt.accessTokenExpiry=PT15M
app.security.jwt.clockSkew=PT30S

# ─────────────────────────────────────────────
# EXTERNAL SERVICES - DISABLED/MOCKED
# ─────────────────────────────────────────────
# Payment Gateways
payment.enabled=false
stripe.enabled=false
stripe.secret-key=sk_test_fake_key_for_testing
stripe.public-key=pk_test_fake_key_for_testing
razorpay.enabled=false
paypal.enabled=false

# Email
spring.mail.host=localhost
spring.mail.port=3025
app.mail.enabled=false

# File Storage
app.storage.type=local
app.storage.local.path=${java.io.tmpdir}/eshop-test-uploads

# External APIs
google.maps.api.enabled=false
sms.enabled=false

# ─────────────────────────────────────────────
# ASYNC & SCHEDULING - DISABLED
# ─────────────────────────────────────────────
spring.task.execution.pool.core-size=1
spring.task.execution.pool.max-size=2
spring.task.scheduling.pool.size=1

# Disable scheduled tasks
app.scheduling.enabled=false

# ─────────────────────────────────────────────
# CACHE - SIMPLE FOR TESTS
# ─────────────────────────────────────────────
spring.cache.type=simple
app.redis.enabled=false
app.redis.resilient.mode=false

# ─────────────────────────────────────────────
# SERVER - TEST CONFIGURATION
# ─────────────────────────────────────────────
# Random port for parallel test execution
server.port=0

# Disable graceful shutdown for faster tests
server.shutdown=immediate

# Session
server.servlet.session.cookie.secure=false
server.servlet.session.timeout=5m

# ─────────────────────────────────────────────
# LOGGING - MINIMAL
# ─────────────────────────────────────────────
logging.level.root=WARN
logging.level.com.eshop=DEBUG
logging.level.org.springframework.test=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# SQL logging (enable for debugging)
#logging.level.org.hibernate.SQL=DEBUG
#logging.level.org.hibernate.orm.jdbc.bind=TRACE

# ─────────────────────────────────────────────
# ERROR HANDLING
# ─────────────────────────────────────────────
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=always
server.error.include-exception=true

# ─────────────────────────────────────────────
# API DOCUMENTATION - DISABLED
# ─────────────────────────────────────────────
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# ─────────────────────────────────────────────
# ACTUATOR - MINIMAL FOR TESTS
# ─────────────────────────────────────────────
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always

# ─────────────────────────────────────────────
# CORS - ALLOW ALL FOR TESTS
# ─────────────────────────────────────────────
app.cors.allowed-origins=*
app.cors.allowed-methods=*
app.cors.allowed-headers=*
app.cors.allow-credentials=false
app.cors.exposed-headers=Authorization,Content-Type,X-Request-Id

# ─────────────────────────────────────────────
# RATE LIMITING - DISABLED
# ─────────────────────────────────────────────
app.rate-limit.enabled=false

# ─────────────────────────────────────────────
# FILE UPLOAD - TEST SETTINGS
# ─────────────────────────────────────────────
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=5MB
spring.servlet.multipart.location=${java.io.tmpdir}/eshop-test-uploads

# ─────────────────────────────────────────────
# TIMEOUTS - SHORTER FOR TESTS
# ─────────────────────────────────────────────
spring.mvc.async.request-timeout=5000
spring.transaction.default-timeout=10

# ─────────────────────────────────────────────
# TEST DATA
# ─────────────────────────────────────────────
app.seed.enabled=false
app.debug=true
app.environment=test

# ─────────────────────────────────────────────
# TESTCONTAINERS (Optional - for integration tests)
# ─────────────────────────────────────────────
#spring.testcontainers.beans.startup=parallel